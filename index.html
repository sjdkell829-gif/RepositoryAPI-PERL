<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Anime Power Management - Erick</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0d1117; color: white; padding: 20px; text-align: center; }
        .form-box { background: #161b22; padding: 20px; border-radius: 10px; border: 1px solid #30363d; max-width: 400px; margin: 0 auto 30px; }
        input { width: 90%; padding: 10px; margin: 10px 0; background: #0d1117; color: white; border: 1px solid #30363d; border-radius: 5px; }
        button { background: #238636; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 5px; }
        .btn-edit { background: #d29922; }
        .btn-delete { background: #da3633; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; max-width: 1000px; margin: auto; }
        .card { background: #161b22; padding: 15px; border-radius: 8px; border-left: 5px solid #58a6ff; text-align: left; }
    </style>
</head>
<body>
    <h1>Gestión de Niveles de Poder ⚡</h1>
    <div class="form-box">
        <input type="text" id="nombre" placeholder="Nombre del Personaje">
        <input type="text" id="universo" placeholder="Universo">
        <input type="text" id="poder" placeholder="Nivel de Poder">
        <button id="btnAccion" onclick="guardar()">Registrar / Actualizar</button>
    </div>
    <div class="grid" id="lista"></div>

    <script>
        const api = '/cgi-bin/api.pl';

        function cargar() {
            fetch(api).then(r => r.json()).then(res => {
                const div = document.getElementById('lista');
                div.innerHTML = '';
                res.data.forEach(p => {
                    div.innerHTML += `
                        <div class="card">
                            <h3>${p.nombre}</h3>
                            <p>${p.universo}</p>
                            <b>${p.nivel_poder}</b><br>
                            <button class="btn-edit" onclick="prepararEdicion('${p.nombre}', '${p.universo}', '${p.nivel_poder}')">Editar</button>
                            <button class="btn-delete" onclick="eliminar('${p.nombre}')">Eliminar</button>
                        </div>`;
                });
            });
        }

        function guardar() {
            const data = {
                nombre: document.getElementById('nombre').value,
                universo: document.getElementById('universo').value,
                nivel_poder: document.getElementById('poder').value
            };
            fetch(api, { method: 'POST', body: JSON.stringify(data) }).then(() => {
                limpiar();
                cargar();
            });
        }

        function prepararEdicion(n, u, p) {
            document.getElementById('nombre').value = n;
            document.getElementById('universo').value = u;
            document.getElementById('poder').value = p;
            document.getElementById('nombre').disabled = true; // El nombre actúa como ID
        }

        function eliminar(nombre) {
            if(confirm('¿Eliminar a ' + nombre + '?')) {
                fetch(api + '?nombre=' + encodeURIComponent(nombre), { method: 'DELETE' })
                .then(() => cargar());
            }
        }

        function limpiar() {
            document.getElementById('nombre').value = '';
            document.getElementById('universo').value = '';
            document.getElementById('poder').value = '';
            document.getElementById('nombre').disabled = false;
        }

        cargar();
    </script>
</body>
</html>